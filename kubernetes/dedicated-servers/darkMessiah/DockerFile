FROM cm2network/steamcmd:latest

# Copiamos el script de arranque como root
USER root
WORKDIR /home/steam

# Descarga el servidor dedicado Windows para Dark Messiah
RUN /home/steam/steamcmd/steamcmd.sh \
      +@sSteamCmdForcePlatformType windows \
      +login anonymous \
      +force_install_dir /home/steam/dm_srv \
      +app_update 2145 validate \
      +quit

# Copiamos start.sh y se lo damos al usuario steam
COPY --chown=steam:steam start.sh .

# Cambiamos al usuario steam y lanzamos
USER steam
ENTRYPOINT ["bash", "start.sh"]
