FROM cm2network/steamcmd:latest

USER root
WORKDIR /home/steam

# 1. Descarga servidor dedicado
RUN /home/steam/steamcmd/steamcmd.sh \
    +@sSteamCmdForcePlatformType windows \
    +force_install_dir /home/steam/dm_srv \
    +login TU_STEAM_USERNAME TU_STEAM_PASSWORD \
    +app_update 2145 validate \
    +quit

# 2. Copia el script de arranque
COPY --chown=steam:steam start.sh .

# 3. Ejecuta como steam
USER steam
ENTRYPOINT ["bash", "start.sh"]
